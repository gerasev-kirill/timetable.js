"use strict";var Timetable=function(){function t(t){var e=t<10?"0":"";return e+t+":00"}this.scope={hourStep:1,dateFormatter:function(e,n){return n?e.getDate()+"/"+e.getMonth()+", "+t(e.getHours()):t(e.getHours())}},this.locations=[],this.events=[]};Timetable.Renderer=function(t){if(!(t instanceof Timetable))throw new Error("Initialize renderer using a Timetable");this.timetable=t},function(){function t(t){return t===parseInt(t,10)}function e(t){return t=new Date(t),!isNaN(t.getTime())}function n(t,n){return e(t)&&e(n)}function o(t,e){for(var n=0;n<e.length;n++)if(t===e[n].id)return!0;return!1}function a(t,n){var o=e(t)&&e(n),a=t<n;return o&&a}function i(t){var e=document.createElement("span");return e.innerHTML=t.trim(),e}function r(t){for(;t.firstChild;)t.removeChild(t.firstChild)}Timetable.prototype={setScope:function(t,e){if(!n(t,e))throw new RangeError("Timetable scope should consist of (start, end) in dates");return this.scope.start=new Date(t),this.scope.end=new Date(e),this},setHourStep:function(e){if(!t(e)||e<0||e>30)throw new Error("Step should be int and more than 0 and less than 30");this.scope.hourStep=e},setDateFormatterFunction:function(t){this.scope.dateFormatter=t},addLocations:function(t){function e(){return t instanceof Array&&"string"==typeof t[0]}function n(){return t instanceof Array&&t[0]instanceof Object}var a=this.locations;if(e())t.forEach(function(t){if(o(t,a))throw new Error("Location already exists");a.push({id:t,title:t})});else{if(!n())throw new Error("Tried to add locations in wrong format");t.forEach(function(t){if(t.hasOwnProperty("locations")){if(o(t,a))throw new Error("Location already exists");return a.push(t),void t.locations.forEach(function(t){if(o(t,a))throw new Error("Location already exists");t instanceof Object?a.push(t):a.push({id:t,title:t})})}if(o(t,a))throw new Error("Location already exists");a.push(t)})}return this},addEvent:function(t,e,n,i,r){if(!o(e,this.locations))throw new Error("Unknown location");if(n=new Date(n),i=new Date(i),!a(n,i))return void console.log("Invalid time range: "+JSON.stringify([n,i]));var s="[object Object]"===Object.prototype.toString.call(r);return this.events.push({name:t,location:e,startDate:n,endDate:i,options:s?r:void 0}),this}},Timetable.Renderer.prototype={draw:function(t){function e(t){if(null===t)throw new Error("Timetable container not found")}function n(t){var e=t.appendChild(document.createElement("aside")),n=e.appendChild(document.createElement("ul"));o(n)}function o(t){for(var e=0;e<g.locations.length;e++){var n=g.locations[e].href,o=t.appendChild(document.createElement("li")),a=o.appendChild(document.createElement("span"));if(void 0!==n){var i=o.appendChild(document.createElement("a"));i.href=g.locations[e].href,i.appendChild(a)}a.className="row-heading",g.locations[e].hasOwnProperty("locations")&&(o.className="row-heading-section"),g.locations[e].hasOwnProperty("class")&&(o.className+=g.locations[e]["class"]),o.title=g.locations[e].title,a.textContent=g.locations[e].title}}function a(t){var e=t.appendChild(document.createElement("section")),n=e.appendChild(document.createElement("time"));s(n),c(n)}function s(t){for(var e,n,o,a=t.appendChild(document.createElement("header")),r=a.appendChild(document.createElement("ul")),s=new Date(v);s<w;)e=r.appendChild(document.createElement("li")),n=i(g.scope.dateFormatter(s,s.getDate()!==o)),n.className="time-label",e.appendChild(n),o=s.getDate(),s.setHours(s.getHours()+g.scope.hourStep)}function c(t){var e=t.appendChild(document.createElement("ul"));e.className="room-timeline";for(var n=0;n<g.locations.length;n++){var o=e.appendChild(document.createElement("li"));if(g.locations[n].hasOwnProperty("locations")){o.className="section";var a=o.appendChild(document.createElement("b"));a.className="section-title";var i=a.appendChild(document.createElement("span"));i.textContent=g.locations[n].title}else l(g.locations[n],o)}}function l(t,e){for(var n=0;n<g.events.length;n++){var o=g.events[n];o.location===t.id&&d(o,e)}}function d(t,e){var n,o,a=void 0!==t.options,i=!1;a&&(n=void 0!==t.options.url,o=void 0!==t.options["class"],i=void 0!==t.options.data);var r=n?"a":"span",s=e.appendChild(document.createElement(r)),c=s.appendChild(document.createElement("small"));if(a?s.title=t.options.tooltip||t.name:s.title=t.name,n&&(s.href=t.options.url),s.setAttribute("data-start-date",t.startDate),s.setAttribute("data-end-date",t.endDate),i)for(var l in t.options.data)s.setAttribute("data-"+l,t.options.data[l]);s.className=o?"time-entry "+t.options["class"]:"time-entry",s.style.width=u(t),s.style.left=h(t),c.textContent=t.name}function u(t){var e=p(t.startDate,t.endDate);return e/C*100+"%"}function p(t,e){return(e.getTime()-t.getTime())/1e3/60/60}function h(t){var e=p(v,t.startDate);return e/C*100+"%"}var f=[];this.timetable.events.forEach(function(t){f.push(t.startDate),f.push(t.endDate)});var m=f.map(function(t){return t.getTime()}),v=this.timetable.scope.start,w=this.timetable.scope.end;if(!this.timetable.scope.start){var E=m.indexOf(Math.min.apply(null,m));v=f[E]}if(!this.timetable.scope.end){var b=m.indexOf(Math.max.apply(null,m));w=f[b]}var g=this.timetable,C=p(v,w)-1,y=document.querySelector(t);e(y),r(y),n(y),a(y)}}}();
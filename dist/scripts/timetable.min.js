"use strict";var Timetable=function(){function t(t){var e=t<10?"0":"";return e+t+":00"}this.scope={hourStep:1,dateFormatter:function(e,n){return n?e.getDate()+"/"+e.getMonth()+", "+t(e.getHours()):t(e.getHours())}},this.locations=[],this.events=[]};Timetable.Renderer=function(t){if(!(t instanceof Timetable))throw new Error("Initialize renderer using a Timetable");this.timetable=t},function(){function t(t){return t===parseInt(t,10)}function e(t){return t=new Date(t),!isNaN(t.getTime())}function n(t){return!(!t||!(t.nodeName||t.prop&&t.attr&&t.find))}function o(t,n){return e(t)&&e(n)}function a(t,e){return(e.getTime()-t.getTime())/1e3/60/60}function i(t,e){for(var n=0;n<e.length;n++)if(t===e[n].id)return!0;return!1}function r(t,n){var o=e(t)&&e(n),a=t<n;return o&&a}function s(t){var e=document.createElement("span");return e.innerHTML=t.trim(),e}function c(t){for(;t.firstChild;)t.removeChild(t.firstChild)}Timetable.prototype={setScope:function(t,e){if(!o(t,e))throw new RangeError("Timetable scope should consist of (start, end) in dates");return this.scope.start=new Date(t),this.scope.end=new Date(e),this},getScope:function(){return JSON.parse(JSON.stringify(this.scope))},setHourStep:function(e){if(!t(e)||e<0)throw new Error("Step should be int and more than 0");this.scope.hourStep=e},setDateFormatterFunction:function(t){this.scope.dateFormatter=t},addLocations:function(t){function e(){return t instanceof Array&&"string"==typeof t[0]}function n(){return t instanceof Array&&t[0]instanceof Object}var o=this.locations;if(e())t.forEach(function(t){if(i(t,o))throw new Error("Location already exists");o.push({id:t,title:t})});else{if(!n())throw new Error("Tried to add locations in wrong format");t.forEach(function(t){if(t.hasOwnProperty("locations")){if(i(t,o))throw new Error("Location already exists");return o.push(t),void t.locations.forEach(function(t){if(i(t,o))throw new Error("Location already exists");t instanceof Object?o.push(t):o.push({id:t,title:t})})}if(i(t,o))throw new Error("Location already exists");o.push(t)})}return this},addEvent:function(t,e,n,o,a){if(!i(e,this.locations))throw new Error("Unknown location");if(n=new Date(n),o=new Date(o),!r(n,o))return void console.log("Invalid time range: "+JSON.stringify([n,o]));var s="[object Object]"===Object.prototype.toString.call(a);return this.events.push({name:t,location:e,startDate:n,endDate:o,options:s?a:void 0}),this}},Timetable.Renderer.prototype={draw:function(e){function o(t){if(null===t)throw new Error("Timetable container not found")}function i(t){var e=t.appendChild(document.createElement("aside")),n=e.appendChild(document.createElement("ul"));r(n)}function r(t){for(var e=0;e<v.locations.length;e++){var n=v.locations[e].href,o=t.appendChild(document.createElement("li")),a=o.appendChild(document.createElement("span"));if(void 0!==n){var i=o.appendChild(document.createElement("a"));i.href=v.locations[e].href,i.appendChild(a)}a.className="row-heading",v.locations[e].hasOwnProperty("locations")&&(o.className="row-heading-section"),v.locations[e].hasOwnProperty("class")&&(o.className+=v.locations[e]["class"]),o.title=v.locations[e].title,a.textContent=v.locations[e].title}}function l(t){var e=t.appendChild(document.createElement("section")),n=e.appendChild(document.createElement("time"));d(n),u(n)}function d(t){for(var e,n,o,a=t.appendChild(document.createElement("header")),i=a.appendChild(document.createElement("ul")),r=new Date(g);r.getTime()<=b.getTime();)e=i.appendChild(document.createElement("li")),n=s(v.scope.dateFormatter(r,r.getDate()!==o)),n.className="time-label",e.appendChild(n),o=r.getDate(),r.setHours(r.getHours()+v.scope.hourStep)}function u(t){var e=t.appendChild(document.createElement("ul"));e.className="room-timeline";for(var n=0;n<v.locations.length;n++){var o=e.appendChild(document.createElement("li"));if(v.locations[n].hasOwnProperty("locations")){o.className="section";var a=o.appendChild(document.createElement("b"));a.className="section-title";var i=a.appendChild(document.createElement("span"));i.textContent=v.locations[n].title}else p(v.locations[n],o)}}function p(t,e){for(var n=0;n<v.events.length;n++){var o=v.events[n];o.location===t.id&&h(o,e)}}function h(t,e){var n,o,a=void 0!==t.options,i=!1;a&&(n=void 0!==t.options.url,o=void 0!==t.options["class"],i=void 0!==t.options.data);var r=n?"a":"span",s=e.appendChild(document.createElement(r)),c=s.appendChild(document.createElement("small"));if(a?s.title=t.options.tooltip||t.name:s.title=t.name,n&&(s.href=t.options.url),s.setAttribute("data-start-date",t.startDate),s.setAttribute("data-end-date",t.endDate),i)for(var l in t.options.data)s.setAttribute("data-"+l,t.options.data[l]);s.className=o?"time-entry "+t.options["class"]:"time-entry",s.style.width=f(t),s.style.left=m(t),c.textContent=t.name}function f(t){var e=a(t.startDate,t.endDate);return e/D*100+"%"}function m(t){var e=a(g,t.startDate);return e/D*100+"%"}var v=this.timetable,w=[];this.timetable.events.forEach(function(t){w.push(t.startDate),w.push(t.endDate)});var E=w.map(function(t){return t.getTime()}),g=this.timetable.scope.start,b=this.timetable.scope.end;if(!this.timetable.scope.start){var C=E.indexOf(Math.min.apply(null,E));g=w[C]}if(!this.timetable.scope.end){var y=E.indexOf(Math.max.apply(null,E));b=w[y]}0!==g.getMinutes()&&g.setMinutes(0);var D=a(g,b),T=D/v.scope.hourStep;t(T)||(D=Math.ceil(T)*v.scope.hourStep,b=new Date(g),b.setHours(D)),this.timetable.scope.durationHours=D;var N;N=n(e)?e:document.querySelector(e),o(N),c(N),i(N),l(N)}}}();
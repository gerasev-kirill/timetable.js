"use strict";var Timetable=function(){function e(e){var t=e<10?"0":"";return t+e+":00"}this.scope={hourStep:1,dateFormatter:function(t,n){return n?t.getDate()+"/"+t.getMonth()+", "+e(t.getHours()):e(t.getHours())}},this.locations=[],this.events=[]};Timetable.Renderer=function(e){if(!(e instanceof Timetable))throw new Error("Initialize renderer using a Timetable");this.timetable=e},function(){function e(e){return e===parseInt(e,10)}function t(e){return e=new Date(e),!isNaN(e.getTime())}function n(e){return!(!e||!(e.nodeName||e.prop&&e.attr&&e.find))}function a(e,n){return t(e)&&t(n)}function i(e,t){return(t.getTime()-e.getTime())/1e3/60/60}function o(e,t){for(var n=0;n<t.length;n++)if(e===t[n].id)return!0;return!1}function r(e,n){var a=t(e)&&t(n),i=e<n;return a&&i}function s(e){var t=document.createElement("span");return t.innerHTML=e.trim(),t}function c(e){for(;e.firstChild;)e.removeChild(e.firstChild)}Timetable.prototype={setScope:function(e,t){if(!a(e,t))throw new RangeError("Timetable scope should consist of (start, end) in dates");return this.scope.start=new Date(e),this.scope.end=new Date(t),this},getScope:function(){return JSON.parse(JSON.stringify(this.scope))},setHourStep:function(t){if(!e(t)||t<0)throw new Error("Step should be int and more than 0");this.scope.hourStep=t},setDateFormatterFunction:function(e){this.scope.dateFormatter=e},addLocations:function(e){function t(){return e instanceof Array&&"string"==typeof e[0]}function n(){return e instanceof Array&&e[0]instanceof Object}var a=this.locations;if(t())e.forEach(function(e){if(o(e,a))throw new Error("Location already exists");a.push({id:e,title:e})});else{if(!n())throw new Error("Tried to add locations in wrong format");e.forEach(function(e){if(e.hasOwnProperty("locations")){if(o(e,a))throw new Error("Location already exists");return a.push(e),void e.locations.forEach(function(e){if(o(e,a))throw new Error("Location already exists");e instanceof Object?a.push(e):a.push({id:e,title:e})})}if(o(e,a))throw new Error("Location already exists");a.push(e)})}return this},addEvent:function(e,t,n,a,i){if(!o(t,this.locations))throw new Error("Unknown location");if(n=new Date(n),a=new Date(a),!r(n,a))return void console.log("Invalid time range: "+JSON.stringify([n,a]));var s="[object Object]"===Object.prototype.toString.call(i);return this.events.push({name:e,location:t,startDate:n,endDate:a,options:s?i:void 0}),this}},Timetable.Renderer.prototype={draw:function(t,a){function o(e){if(null===e)throw new Error("Timetable container not found")}function r(e){var t=e.appendChild(document.createElement("aside")),n=t.appendChild(document.createElement("ul"));l(n)}function l(e){for(var t=0;t<g.locations.length;t++){var n=g.locations[t].href,i=e.appendChild(document.createElement("li")),o=i.appendChild(document.createElement("span"));if("vertical"===a&&(i.className="th-column"),void 0!==n){var r=i.appendChild(document.createElement("a"));r.href=g.locations[t].href,r.appendChild(o)}o.className="row-heading",g.locations[t].hasOwnProperty("locations")&&(i.className="row-heading-section"),g.locations[t].hasOwnProperty("class")&&(i.className+=g.locations[t]["class"]),i.title=g.locations[t].title,o.textContent=g.locations[t].title}}function d(e){var t=e.appendChild(document.createElement("section")),n=t.appendChild(document.createElement("time")),a=u(n);return p(n,a)}function u(e){for(var t,n,a,i=e.appendChild(document.createElement("header")),o=i.appendChild(document.createElement("ul")),r=new Date(C);r.getTime()<=y.getTime();)t=o.appendChild(document.createElement("li")),n=s(g.scope.dateFormatter(r,r.getDate()!==a)),n.className="time-label",t.appendChild(n),a=r.getDate(),r.setHours(r.getHours()+g.scope.hourStep);return(i.getBoundingClientRect().height||0)-(t.getBoundingClientRect().height||0)}function p(e,t){"vertical"===a&&(e=e.appendChild(document.createElement("div")),e.className="room-timeline-vertical-container",e=e.appendChild(document.createElement("div")));var n=e.appendChild(document.createElement("ul"));n.className="room-timeline";for(var i=0;i<g.locations.length;i++){var o=n.appendChild(document.createElement("li"));if("vertical"===a&&t&&t>0&&(o.style.height=t+"px",o.className="td-column"),g.locations[i].hasOwnProperty("locations")){o.className=(o.className||"")+" section";var r=o.appendChild(document.createElement("b"));r.className="section-title";var s=r.appendChild(document.createElement("span"));s.textContent=g.locations[i].title}else m(g.locations[i],o)}return e}function m(e,t){for(var n=0;n<g.events.length;n++){var a=g.events[n];a.location===e.id&&h(a,t)}}function h(e,t){var n,i,o=void 0!==e.options,r=!1;o&&(n=void 0!==e.options.url,i=void 0!==e.options["class"],r=void 0!==e.options.data);var s=n?"a":"span",c=t.appendChild(document.createElement(s));if(o?c.title=e.options.tooltip||e.name||"":c.title=e.name||"",n&&(c.href=e.options.url),c.setAttribute("data-start-date",e.startDate),c.setAttribute("data-end-date",e.endDate),r)for(var l in e.options.data)c.setAttribute("data-"+l,e.options.data[l]);if(c.className=i?"time-entry "+e.options["class"]:"time-entry","vertical"===a){var d=f(e),u=v(e);u+d>100&&(d=100-u),c.style.height=d+"%",c.style.top=u+"%"}else c.style.width=f(e)+"%",c.style.left=v(e)+"%";if(o&&e.options.template){var p=document.createElement("span");p.className="time-entry-template-content";var m=p.appendChild(document.createElement("span"));m.className="time-entry-template-content-inner",m.innerHTML=(e.options.template+"").trim(),c.appendChild(p)}else{var h=c.appendChild(document.createElement("small"));h.textContent=e.name}}function f(e){var t=i(e.startDate,e.endDate);return t/N*100}function v(e){var t=i(C,e.startDate);return t/N*100}var g=this.timetable,w=[];this.timetable.events.forEach(function(e){w.push(e.startDate),w.push(e.endDate)});var E=w.map(function(e){return e.getTime()}),C=this.timetable.scope.start,y=this.timetable.scope.end;if(["vertical","horizontal"].indexOf(a)===-1&&(a="horizontal"),!this.timetable.scope.start){var b=E.indexOf(Math.min.apply(null,E));C=w[b]}if(!this.timetable.scope.end){var D=E.indexOf(Math.max.apply(null,E));y=w[D]}0!==C.getMinutes()&&C.setMinutes(0);var N=i(C,y),T=N/g.scope.hourStep;e(T)||(N=Math.ceil(T)*g.scope.hourStep,y=new Date(C),y.setHours(N)),this.timetable.scope.durationHours=N;var O;O=n(t)?t:document.querySelector(t),o(O),c(O),r(O),d(O)}}}();
"use strict";var Timetable=function(){function t(t){var e=t<10?"0":"";return e+t+":00"}this.scope={hourStep:1,dateFormatter:function(e,n){return n?e.getDate()+"/"+e.getMonth()+", "+t(e.getHours()):t(e.getHours())}},this.locations=[],this.events=[]};Timetable.Renderer=function(t){if(!(t instanceof Timetable))throw new Error("Initialize renderer using a Timetable");this.timetable=t},function(){function t(t){return t===parseInt(t,10)}function e(t){return t=new Date(t),!isNaN(t.getTime())}function n(t){return!(!t||!(t.nodeName||t.prop&&t.attr&&t.find))}function o(t,n){return e(t)&&e(n)}function a(t,e){return(e.getTime()-t.getTime())/1e3/60/60}function i(t,e){for(var n=0;n<e.length;n++)if(t===e[n].id)return!0;return!1}function r(t,n){var o=e(t)&&e(n),a=t<n;return o&&a}function s(t){var e=document.createElement("span");return e.innerHTML=t.trim(),e}function c(t){for(;t.firstChild;)t.removeChild(t.firstChild)}Timetable.prototype={setScope:function(t,e){if(!o(t,e))throw new RangeError("Timetable scope should consist of (start, end) in dates");return this.scope.start=new Date(t),this.scope.end=new Date(e),this},getScope:function(){return JSON.parse(JSON.stringify(this.scope))},setHourStep:function(e){if(!t(e)||e<0)throw new Error("Step should be int and more than 0");this.scope.hourStep=e},setDateFormatterFunction:function(t){this.scope.dateFormatter=t},addLocations:function(t){function e(){return t instanceof Array&&"string"==typeof t[0]}function n(){return t instanceof Array&&t[0]instanceof Object}var o=this.locations;if(e())t.forEach(function(t){if(i(t,o))throw new Error("Location already exists");o.push({id:t,title:t})});else{if(!n())throw new Error("Tried to add locations in wrong format");t.forEach(function(t){if(t.hasOwnProperty("locations")){if(i(t,o))throw new Error("Location already exists");return o.push(t),void t.locations.forEach(function(t){if(i(t,o))throw new Error("Location already exists");t instanceof Object?o.push(t):o.push({id:t,title:t})})}if(i(t,o))throw new Error("Location already exists");o.push(t)})}return this},addEvent:function(t,e,n,o,a){if(!i(e,this.locations))throw new Error("Unknown location");if(n=new Date(n),o=new Date(o),!r(n,o))return void console.log("Invalid time range: "+JSON.stringify([n,o]));var s="[object Object]"===Object.prototype.toString.call(a);return this.events.push({name:t,location:e,startDate:n,endDate:o,options:s?a:void 0}),this}},Timetable.Renderer.prototype={draw:function(e,o){function i(t){if(null===t)throw new Error("Timetable container not found")}function r(t){var e=t.appendChild(document.createElement("aside")),n=e.appendChild(document.createElement("ul"));l(n)}function l(t){for(var e=0;e<g.locations.length;e++){var n=g.locations[e].href,a=t.appendChild(document.createElement("li")),i=a.appendChild(document.createElement("span"));if("vertical"===o&&(a.className="th-column"),void 0!==n){var r=a.appendChild(document.createElement("a"));r.href=g.locations[e].href,r.appendChild(i)}i.className="row-heading",g.locations[e].hasOwnProperty("locations")&&(a.className="row-heading-section"),g.locations[e].hasOwnProperty("class")&&(a.className+=g.locations[e]["class"]),a.title=g.locations[e].title,i.textContent=g.locations[e].title}}function d(t){var e=t.appendChild(document.createElement("section")),n=e.appendChild(document.createElement("time")),o=u(n);return p(n,o)}function u(t){for(var e,n,o,a=t.appendChild(document.createElement("header")),i=a.appendChild(document.createElement("ul")),r=new Date(C);r.getTime()<=b.getTime();)e=i.appendChild(document.createElement("li")),n=s(g.scope.dateFormatter(r,r.getDate()!==o)),n.className="time-label",e.appendChild(n),o=r.getDate(),r.setHours(r.getHours()+g.scope.hourStep);return(a.getBoundingClientRect().height||0)-(e.getBoundingClientRect().height||0)}function p(t,e){"vertical"===o&&(t=t.appendChild(document.createElement("div")),t.className="room-timeline-vertical-container",t=t.appendChild(document.createElement("div")));var n=t.appendChild(document.createElement("ul"));n.className="room-timeline";for(var a=0;a<g.locations.length;a++){var i=n.appendChild(document.createElement("li"));if("vertical"===o&&e&&e>0&&(i.style.height=e+"px",i.className="td-column"),g.locations[a].hasOwnProperty("locations")){i.className=(i.className||"")+" section";var r=i.appendChild(document.createElement("b"));r.className="section-title";var s=r.appendChild(document.createElement("span"));s.textContent=g.locations[a].title}else h(g.locations[a],i)}return t}function h(t,e){for(var n=0;n<g.events.length;n++){var o=g.events[n];o.location===t.id&&m(o,e)}}function m(t,e){var n,a,i=void 0!==t.options,r=!1;i&&(n=void 0!==t.options.url,a=void 0!==t.options["class"],r=void 0!==t.options.data);var s=n?"a":"span",c=e.appendChild(document.createElement(s)),l=c.appendChild(document.createElement("small"));if(i?c.title=t.options.tooltip||t.name:c.title=t.name,n&&(c.href=t.options.url),c.setAttribute("data-start-date",t.startDate),c.setAttribute("data-end-date",t.endDate),r)for(var d in t.options.data)c.setAttribute("data-"+d,t.options.data[d]);if(c.className=a?"time-entry "+t.options["class"]:"time-entry","vertical"===o){var u=f(t),p=v(t);p+u>100&&(u=100-p),c.style.height=u+"%",c.style.top=p+"%"}else c.style.width=f(t)+"%",c.style.left=v(t)+"%";l.textContent=t.name}function f(t){var e=a(t.startDate,t.endDate);return e/N*100}function v(t){var e=a(C,t.startDate);return e/N*100}var g=this.timetable,w=[];this.timetable.events.forEach(function(t){w.push(t.startDate),w.push(t.endDate)});var E=w.map(function(t){return t.getTime()}),C=this.timetable.scope.start,b=this.timetable.scope.end;if(["vertical","horizontal"].indexOf(o)===-1&&(o="horizontal"),!this.timetable.scope.start){var y=E.indexOf(Math.min.apply(null,E));C=w[y]}if(!this.timetable.scope.end){var D=E.indexOf(Math.max.apply(null,E));b=w[D]}0!==C.getMinutes()&&C.setMinutes(0);var N=a(C,b),T=N/g.scope.hourStep;t(T)||(N=Math.ceil(T)*g.scope.hourStep,b=new Date(C),b.setHours(N)),this.timetable.scope.durationHours=N;var O;O=n(e)?e:document.querySelector(e),i(O),c(O),r(O),d(O)}}}();